{
  "hash": "a0c862355d5388aeea214d0b7285ae87",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Dimension reduction 1\"\nauthor: \"Claus O. Wilke\"\ndate: last-modified\nformat: \n  revealjs:\n    theme:\n      - default\n      - Wilke-theme.scss\n    auto-stretch: false\n    chalkboard: true\nexecute:\n  fig-format: svg\n  fig-asp: 0.618\n  fig-width: 5.5\n---\n\n\n\n\n\n\n## Problem:<br>How do we visualize datasets with many variables?\n\n## Problem:<br>How do we visualize datasets with many variables?\n\nExample: blue jays dataset\n\n::: {.tiny-font}\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n\n|sex | bill_depth_mm| bill_width_mm| bill_length_mm| head_length_mm| body_mass_g| skull_size_mm|\n|:---|-------------:|-------------:|--------------:|--------------:|-----------:|-------------:|\n|M   |          8.26|          9.21|          25.92|          56.58|       73.30|         30.66|\n|M   |          8.54|          8.76|          24.99|          56.36|       75.10|         31.38|\n|M   |          8.39|          8.78|          26.07|          57.32|       70.25|         31.25|\n|F   |          7.78|          9.30|          23.48|          53.77|       65.50|         30.29|\n|M   |          8.71|          9.84|          25.47|          57.32|       74.90|         31.85|\n|F   |          7.28|          9.30|          22.25|          52.25|       63.90|         30.00|\n|M   |          8.74|          9.28|          25.35|          57.12|       75.10|         31.77|\n|M   |          8.72|          9.94|          30.00|          60.67|       78.10|         30.67|\n|F   |          8.20|          9.01|          22.78|          52.83|       64.00|         30.05|\n|F   |          7.67|          9.31|          24.61|          54.94|       67.33|         30.33|\n|M   |          8.78|          8.83|          25.72|          56.54|       76.40|         30.82|\n|F   |          8.15|          8.67|          24.66|          54.69|       71.50|         30.03|\n|M   |          8.62|          9.28|          24.50|          56.48|       78.20|         31.98|\n|F   |          7.65|          9.11|          23.93|          55.75|       73.40|         31.83|\n|M   |          7.96|          9.31|          25.62|          57.34|       77.00|         31.73|\n|F   |          8.17|          8.49|          23.15|          53.05|       65.00|         29.90|\n|F   |          8.13|          8.88|          25.00|          54.81|       75.20|         29.81|\n|M   |          8.19|          9.98|          25.40|          58.70|       75.70|         33.30|\n|M   |          8.49|          8.81|          25.93|          57.07|       78.40|         31.15|\n|M   |          8.35|          9.57|          24.40|          55.79|       70.60|         31.39|\n|M   |          8.53|          9.71|          26.30|          58.31|       74.70|         32.00|\n|M   |          8.07|          8.38|          23.62|          54.51|       70.00|         30.89|\n|M   |          8.23|         10.31|          26.66|          58.21|       75.40|         31.55|\n|F   |          7.86|          9.21|          23.87|          54.09|       75.20|         30.22|\n|M   |          8.42|          9.30|          24.98|          56.80|       74.50|         31.83|\n|F   |          8.48|          9.64|          25.40|          56.82|       62.20|         31.42|\n|F   |          8.22|          9.09|          23.00|          55.39|       72.30|         32.39|\n|F   |          8.18|          9.44|          23.44|          54.21|       74.00|         30.77|\n|M   |          8.23|          9.67|          24.86|          56.88|       73.73|         32.02|\n|F   |          8.44|          9.19|          26.14|          56.37|       73.97|         30.24|\n|F   |          7.21|          8.21|          23.13|          53.70|       66.80|         30.57|\n|M   |          8.88|          9.58|          26.19|          55.96|       75.18|         29.77|\n|F   |          8.58|         10.63|          24.75|          55.83|       78.30|         31.08|\n|F   |          8.36|          9.63|          24.92|          55.47|       70.60|         30.55|\n|M   |          8.20|          8.68|          24.24|          55.96|       72.10|         31.72|\n|M   |          8.42|         10.24|          25.40|          56.59|       70.20|         31.19|\n|M   |          8.60|          8.40|          25.50|          57.50|       74.00|         32.00|\n|M   |          7.96|          8.62|          24.55|          56.01|       69.67|         31.46|\n|F   |          7.58|         10.00|          23.42|          54.49|       69.40|         31.07|\n|F   |          8.05|          9.35|          24.46|          56.04|       77.60|         31.58|\n|M   |          8.34|          8.62|          23.92|          53.74|       60.17|         29.82|\n|F   |          7.69|          9.01|          23.31|          54.13|       70.50|         30.82|\n|M   |          8.88|          9.22|          25.68|          56.80|       67.50|         31.12|\n|M   |          8.55|          9.03|          26.55|          57.86|       75.95|         31.31|\n|F   |          8.42|          9.49|          26.30|          56.50|       79.50|         30.20|\n|M   |          8.54|          8.96|          25.73|          56.82|       77.50|         31.09|\n|M   |          8.54|          9.40|          24.29|          56.35|       79.20|         32.06|\n|F   |          7.57|          9.32|          23.48|          54.31|       65.30|         30.83|\n|M   |          8.40|          8.20|          25.70|          56.40|       69.00|         30.70|\n|F   |          8.11|          8.37|          24.07|          53.04|       65.60|         28.97|\n|F   |          8.19|          9.38|          24.93|          55.58|       67.83|         30.64|\n|F   |          8.46|          9.69|          25.30|          56.84|       75.70|         31.54|\n|M   |          8.58|          9.63|          26.12|          57.00|       72.60|         30.88|\n|F   |          7.80|          8.74|          23.89|          53.74|       58.80|         29.85|\n|F   |          8.10|          8.44|          23.75|          55.74|       70.90|         32.00|\n|F   |          8.70|          8.91|          25.46|          55.37|       66.30|         29.91|\n|M   |          8.82|          8.60|          25.46|          56.86|       73.90|         31.40|\n|M   |          8.39|          9.12|          26.58|          57.64|       71.35|         31.06|\n|M   |          7.89|          9.07|          26.12|          57.86|       73.90|         31.74|\n|M   |          7.93|          8.72|          24.93|          55.02|       67.20|         30.09|\n|M   |          8.86|         10.02|          25.04|          57.30|       73.00|         32.26|\n|M   |          9.00|          9.40|          25.50|          56.90|       74.00|         31.40|\n|F   |          8.00|          8.90|          23.60|          52.80|       63.70|         29.20|\n|F   |          8.20|          9.00|          25.00|          54.20|       72.80|         29.20|\n|M   |          8.70|          9.80|          25.60|          57.30|       76.30|         31.70|\n|F   |          7.80|          8.00|          23.10|          53.90|       66.00|         30.80|\n|M   |          8.20|          9.90|          24.40|          56.70|       74.00|         32.30|\n|M   |          8.20|          9.50|          24.00|          56.30|       76.30|         32.30|\n|M   |          8.60|          9.60|          23.70|          55.50|       71.30|         31.80|\n|F   |          7.30|          9.90|          22.40|          53.90|       65.00|         31.50|\n|M   |          8.40|          9.40|          25.00|          56.10|       73.80|         31.10|\n|F   |          8.00|          9.30|          23.40|          54.00|       69.00|         30.60|\n|M   |          8.30|          9.20|          24.30|          54.90|       72.10|         30.60|\n|M   |          8.60|          9.80|          26.00|          59.20|       80.90|         33.20|\n|F   |          8.30|          9.00|          25.70|          55.00|       68.50|         29.30|\n|F   |          8.20|          9.70|          24.60|          54.40|       70.00|         29.80|\n|M   |          8.50|          9.60|          25.50|          56.70|       75.90|         31.20|\n|M   |          8.20|          9.30|          24.90|          55.50|       70.00|         30.60|\n|F   |          8.30|          8.20|          23.70|          53.60|       69.00|         29.90|\n|M   |          8.80|          9.70|          25.30|          56.60|       75.80|         31.30|\n|M   |          8.20|          8.10|          25.90|          57.50|       69.70|         31.60|\n|M   |          8.80|          9.80|          27.30|          56.20|       65.50|         28.90|\n|F   |          7.60|          8.30|          24.80|          56.20|       67.90|         31.40|\n|F   |          8.80|          9.70|          25.50|          56.70|       81.50|         31.20|\n|M   |          8.56|          9.20|          26.62|          56.48|       74.00|         29.86|\n|M   |          8.92|          9.22|          24.78|          56.45|       71.50|         31.67|\n|F   |          7.74|          9.27|          25.05|          55.76|       66.10|         30.71|\n|F   |          7.91|          9.38|          25.73|          55.70|       69.80|         29.97|\n|M   |          8.72|          9.25|          24.30|          54.76|       68.50|         30.46|\n|F   |          7.55|          8.62|          23.55|          52.74|       70.00|         29.19|\n|M   |          8.43|          9.27|          26.32|          56.44|       66.75|         30.12|\n|M   |          8.20|          9.28|          26.27|          58.50|       76.50|         32.23|\n|F   |          7.62|          9.88|          25.71|          55.97|       69.30|         30.26|\n|M   |          8.51|          9.64|          25.91|          55.64|       67.80|         29.73|\n|F   |          8.21|          9.21|          23.60|          53.88|       75.50|         30.28|\n|F   |          7.86|          9.39|          23.36|          54.04|       73.25|         30.69|\n|M   |          8.58|          9.73|          27.04|          57.56|       71.90|         30.52|\n|M   |          8.59|          9.97|          25.88|          56.00|       79.55|         30.12|\n|F   |          7.72|          8.97|          22.88|          53.03|       66.75|         30.15|\n|F   |          7.58|          9.04|          24.02|          55.65|       73.20|         31.63|\n|F   |          8.40|          8.40|          23.90|          54.70|       72.35|         30.80|\n|F   |          7.90|          8.48|          22.78|          51.60|       64.00|         28.82|\n|M   |          8.12|          9.67|          24.90|          55.91|       73.50|         31.01|\n|F   |          7.92|          9.16|          23.92|          54.69|       68.90|         30.77|\n|F   |          7.96|          9.09|          24.33|          54.58|       73.80|         30.25|\n|M   |          8.10|          9.10|          25.90|          57.10|       77.40|         31.20|\n|F   |          7.50|          9.57|          24.60|          53.80|       61.40|         29.20|\n|M   |          8.15|          9.72|          26.05|          56.85|       73.40|         30.80|\n|F   |          7.71|          8.58|          25.06|          54.15|       61.20|         29.09|\n|F   |          8.05|          9.25|          25.20|          56.25|       69.65|         31.05|\n|F   |          8.57|          8.97|          25.15|          54.80|       77.00|         29.64|\n|F   |          8.69|          9.43|          24.94|          56.09|       72.20|         31.15|\n|F   |          8.02|          8.62|          24.09|          55.82|       76.55|         31.73|\n|F   |          8.57|         10.82|          23.68|          53.95|       68.25|         30.27|\n|M   |          8.33|          9.27|          25.78|          56.71|       71.50|         30.93|\n|M   |          8.43|          9.23|          25.28|          57.25|       77.53|         31.97|\n|M   |          8.20|          9.06|          24.22|          54.58|       68.95|         30.36|\n|F   |          8.30|          9.28|          23.92|          56.28|       78.80|         32.36|\n|M   |          8.70|          9.12|          24.62|          56.61|       77.00|         31.99|\n|M   |          7.96|          9.80|          25.07|          55.68|       68.00|         30.61|\n|F   |          7.90|          9.30|          23.60|          53.90|       63.90|         30.30|\n|F   |          7.63|          8.56|          24.29|          54.19|       70.45|         29.90|\n|F   |          7.90|          8.00|          23.00|          52.70|       66.00|         29.70|\n\n\n:::\n:::\n\n\n\n:::\n\n## All-by-all scatter plots are hard to read \n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![&nbsp;](dimension-reduction-1_files/figure-revealjs/blue-jays-scattermatrix-1.svg){width=100%}\n:::\n:::\n\n\n\n\n## Solution: Dimension reduction\n\n::: {.incremental}\n- We project the data into a lower-dimensional space\n- Commonly-used method:<br>Principal Components Analysis (PCA)\n- PCA is a rotation of the coordinate system\n:::\n\n## Principal Components Analysis (PCA)\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![&nbsp;](dimension-reduction-1_files/figure-revealjs/blue-jays-PCA-1.svg){width=100%}\n:::\n:::\n\n\n\n\n## Principal Components Analysis (PCA)\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![&nbsp;](dimension-reduction-1_files/figure-revealjs/blue-jays-PCA2-1.svg){width=100%}\n:::\n:::\n\n\n\n\n## Principal Components Analysis (PCA)\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![&nbsp;](dimension-reduction-1_files/figure-revealjs/blue-jays-PCA3-1.svg){width=100%}\n:::\n:::\n\n\n\n\n::: {.fragment .small}\nPCA aligns the major axes with directions of maximum variation in the data\n:::\n\n## PCA analysis of the entire blue jays dataset\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![&nbsp;](dimension-reduction-1_files/figure-revealjs/blue-scatter-1.svg){width=75%}\n:::\n:::\n\n\n\n\n::: {.fragment .small-font .move-up-1em}\nMale and female birds separate along PC1\n:::\n\n## The rotation matrix allows us to interpret the PCs\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![&nbsp;](dimension-reduction-1_files/figure-revealjs/blue-rotation-1.svg){width=75%}\n:::\n:::\n\n\n\n\n::: {.fragment .small-font .move-up-1em}\nAll variables contribute negatively to PC1; it represents the overall size of the bird\n:::\n\n## The rotation matrix allows us to interpret the PCs\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![&nbsp;](dimension-reduction-1_files/figure-revealjs/blue-rotation2-1.svg){width=75%}\n:::\n:::\n\n\n\n\n::: {.small-font .move-up-1em}\nPC2 represents the difference between bill length and skull size\n:::\n\n## The rotation matrix allows us to interpret the PCs\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![&nbsp;](dimension-reduction-1_files/figure-revealjs/blue-rotation-combined-1.svg){width=100%}\n:::\n:::\n\n\n\n\n::: {.small-font .move-up-1em}\n- Male birds are larger than female birds\n- Both male and female birds have long and short bills relative to their overall size\n:::\n\n## We also plot the variance explained by each PC\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![&nbsp;](dimension-reduction-1_files/figure-revealjs/pca-eigenvalues-1.svg){width=75%}\n:::\n:::\n\n\n\n\n::: {.small-font .move-up-1em}\nPC 1 captures over 50% of the total variance in the dataset\n:::\n\n## We also plot the variance explained by each PC\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![&nbsp;](dimension-reduction-1_files/figure-revealjs/pca-eigenvalues2-1.svg){width=75%}\n:::\n:::\n\n\n\n\n::: {.small-font .move-up-1em}\nOverall bird size explains >50% of the variation in the various measurements\n:::\n\n<!-- Segment ends here -->\n\n#\n\n# The mathematics of principal components analysis\n\n## The mathematics of PCA\n\nVariance of one variable $X$:\n\n$$\\text{Var}(X) = \\frac{1}{n}\\sum_j (\\bar x - x_j)^2 = \\sigma_X^2$$\n\n::: {.fragment}\nCovariance of two variables $X$ and $Y$:\n\n$$\\text{Cov}(X, Y) = \\frac{1}{n}\\sum_j (\\bar x - x_j)(\\bar y - y_j) = \\sigma_{XY}$$\n:::\n\n## The mathematics of PCA\n\nCovariance matrix of $n$ variables $X_1 \\dots X_n$:\n\n$$\\text{C} = \\left(\n\\begin{array}{cccc}\n  \\sigma_{11}^2 & \\sigma_{12} & \\dots & \\sigma_{1n}  \\\\\n  \\sigma_{21} & \\sigma_{22}^2 & \\dots & \\sigma_{2n} \\\\\n  \\vdots & \\vdots & \\ddots & \\vdots \\\\\n  \\sigma_{n1} & \\sigma_{n2} & \\dots & \\sigma_{nn}^2  \\\\\n\\end{array}\n\\right)$$\n\n## The mathematics of PCA\n\nPCA diagonalizes the covariance matrix $\\text{C}$:\n\n$$\\begin{eqnarray}\n\\text{C} & = & \\text{U}\\text{D}\\text{U}^\\text{T}\\\\\n& = & \\text{U}\\left(\n\\begin{array}{cccc}\n  \\lambda_{1}^2 & 0 & \\dots & 0  \\\\\n  0 & \\lambda_{2}^2 & \\dots & 0  \\\\\n  \\vdots & \\vdots & \\ddots & \\vdots \\\\\n  0 & 0 & \\dots & \\lambda_{n}^2  \\\\\n\\end{array}\n\\right)\\text{U}^\\text{T}\n\\end{eqnarray}$$\n\n::: {.fragment}\n$\\text{U}$: rotation matrix\n:::\n\n::: {.fragment}\n$\\text{D}$: diagonal matrix\n:::\n\n::: {.fragment}\n$\\lambda_j^2$: eigenvalues (= variance explained by each component)\n:::\n\n## The mathematics of PCA\n\nPCA diagonalizes the covariance matrix $\\text{C}$:\n\n$$\\begin{eqnarray}\n\\text{C} & = & \\text{U}\\text{D}\\text{U}^\\text{T}\\\\\n& = & \\text{U}\\left(\n\\begin{array}{cccc}\n  \\lambda_{1}^2 & 0 & \\dots & 0  \\\\\n  0 & \\lambda_{2}^2 & \\dots & 0  \\\\\n  \\vdots & \\vdots & \\ddots & \\vdots \\\\\n  0 & 0 & \\dots & \\lambda_{n}^2  \\\\\n\\end{array}\n\\right)\\text{U}^\\text{T}\n\\end{eqnarray}$$\n\nThe covariances between components are all 0\n\nComponents are uncorrelated\n\n## The components are uncorrelated\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![&nbsp;](dimension-reduction-1_files/figure-revealjs/blue-scatter2-1.svg){width=75%}\n:::\n:::\n\n\n\n\n<!-- Segment ends here -->\n\n#\n\n# Doing a PCA in R\n\n## Getting the data\n\n::: {.small-font}\nThe `blue_jays` dataset:\n:::\n\n::: {.smaller-font}\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nblue_jays <- read_csv(\"https://wilkelab.org/DSC385/datasets/blue_jays.csv\")\n\nblue_jays\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 123 × 8\n   bird_id    sex   bill_depth_mm bill_width_mm bill_length_mm head_length_mm\n   <chr>      <chr>         <dbl>         <dbl>          <dbl>          <dbl>\n 1 0000-00000 M              8.26          9.21           25.9           56.6\n 2 1142-05901 M              8.54          8.76           25.0           56.4\n 3 1142-05905 M              8.39          8.78           26.1           57.3\n 4 1142-05907 F              7.78          9.3            23.5           53.8\n 5 1142-05909 M              8.71          9.84           25.5           57.3\n 6 1142-05911 F              7.28          9.3            22.2           52.2\n 7 1142-05912 M              8.74          9.28           25.4           57.1\n 8 1142-05914 M              8.72          9.94           30             60.7\n 9 1142-05917 F              8.2           9.01           22.8           52.8\n10 1142-05920 F              7.67          9.31           24.6           54.9\n# ℹ 113 more rows\n# ℹ 2 more variables: body_mass_g <dbl>, skull_size_mm <dbl>\n```\n\n\n:::\n:::\n\n\n\n:::\n\n## Getting the data\n\n::: {.small-font}\nThe `pottery` dataset:\n:::\n\n::: {.smaller-font}\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npottery <- read_csv(\"https://wilkelab.org/DSC385/datasets/pottery.csv\")\n\npottery\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 48 × 12\n   ID    Kiln       Region Al2O3 Fe2O3   MgO   CaO  Na2O   K2O  TiO2   MnO   BaO\n   <chr> <chr>      <chr>  <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl>\n 1 GA1   Gloucester Glouc…  18.8  9.52  2     0.79  0.4   3.2   1.01 0.077 0.015\n 2 GA2   Gloucester Glouc…  16.9  7.33  1.65  0.84  0.4   3.05  0.99 0.067 0.018\n 3 GA3   Gloucester Glouc…  18.2  7.64  1.82  0.77  0.4   3.07  0.98 0.087 0.014\n 4 GA4   Gloucester Glouc…  17.4  7.48  1.71  1.01  0.4   3.16  0.03 0.084 0.017\n 5 GA5   Gloucester Glouc…  16.9  7.29  1.56  0.76  0.4   3.05  1    0.063 0.019\n 6 GB1   Gloucester Glouc…  17.8  7.24  1.83  0.92  0.43  3.12  0.93 0.061 0.019\n 7 GB2   Gloucester Glouc…  18.8  7.45  2.06  0.87  0.25  3.26  0.98 0.072 0.017\n 8 GB3   Gloucester Glouc…  16.5  7.05  1.81  1.73  0.33  3.2   0.95 0.066 0.019\n 9 GB4   Gloucester Glouc…  18    7.42  2.06  1     0.28  3.37  0.96 0.072 0.017\n10 GB5   Gloucester Glouc…  15.8  7.15  1.62  0.71  0.38  3.25  0.93 0.062 0.017\n# ℹ 38 more rows\n```\n\n\n:::\n:::\n\n\n\n:::\n\n## Prerequisite: Scaling of numeric columns\n\n::: {.small-font}\nPlot without scaling\n:::\n\n::: {.tiny-font}\n\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code}\nblue_jays |>\n  ggplot() +\n  aes(skull_size_mm, head_length_mm) + \n  geom_point(aes(color = sex))\n```\n\n::: {.cell-output-display}\n![&nbsp;](dimension-reduction-1_files/figure-revealjs/blue-jays-unscaled-1.svg){width=100%}\n:::\n:::\n\n\n\n:::\n\n## Prerequisite: Scaling of numeric columns\n\n::: {.small-font}\nPlot with scaling\n:::\n\n::: {.tiny-font}\n\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code}\nblue_jays |>\n  # scale all numeric columns\n  mutate(across(where(is.numeric), scale)) |>\n  ggplot() +\n  aes(skull_size_mm, head_length_mm) + \n  geom_point(aes(color = sex))\n```\n\n::: {.cell-output-display}\n![&nbsp;](dimension-reduction-1_files/figure-revealjs/blue-jays-scaled-1.svg){width=100%}\n:::\n:::\n\n\n\n:::\n\n## We perform a PCA with `prcomp()`\n\n::: {.small-font}\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nblue_jays |> \n  select(where(is.numeric)) |> # retain only numeric columns\n  scale() |>                   # scale to zero mean and unit variance\n  prcomp()                     # do PCA\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nStandard deviations (1, .., p=6):\n[1] 1.801735505 1.001664889 0.898426518 0.736457067 0.633147386 0.001337779\n\nRotation (n x k) = (6 x 6):\n                      PC1          PC2         PC3         PC4          PC5\nbill_depth_mm  -0.3969857  0.342262537 -0.15267580  0.70664985  0.450105291\nbill_width_mm  -0.2810408  0.044926541  0.95822204  0.02838445 -0.001569506\nbill_length_mm -0.4209312  0.544180448 -0.13629166 -0.43921746 -0.141941341\nhead_length_mm -0.5231576 -0.007875712 -0.14075388 -0.40403900  0.131442872\nbody_mass_g    -0.4308880 -0.277787878 -0.12517605  0.35651048 -0.770973799\nskull_size_mm  -0.3561979 -0.712374529 -0.06666709 -0.12876761  0.406912265\n                         PC6\nbill_depth_mm  -0.0001782600\nbill_width_mm  -0.0001746131\nbill_length_mm -0.5431849028\nhead_length_mm  0.7251949252\nbody_mass_g     0.0002123608\nskull_size_mm  -0.4231339911\n```\n\n\n:::\n:::\n\n\n\n:::\n\n## Calculate the components and plot\n\n::: {.small-font}\nFirst we run the PCA and store results as `pca_fit`:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npca_fit <- blue_jays |> \n  select(where(is.numeric)) |> # retain only numeric columns\n  scale() |>                   # scale to zero mean and unit variance\n  prcomp()                     # do PCA\n```\n:::\n\n\n\n:::\n\n::: {.fragment .small-font}\nThen we add PC coordinates into original dataset and plot:\n\n```r\nlibrary(broom)  # for augment(), tidy()\n\npca_fit |>\n  # add PCs to the original dataset\n  augment(blue_jays) |>\n  ggplot(aes(.fittedPC1, .fittedPC2)) +\n  geom_point(aes(color = sex))\n```\n:::\n\n## Calculate the components and plot\n\n::: {.small-font}\nPlot PC 2 against PC 1\n:::\n\n::: {.tiny-font}\n\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code}\npca_fit |>\n  # add PCs to the original dataset\n  augment(blue_jays) |>\n  ggplot(aes(.fittedPC1, .fittedPC2)) +\n  geom_point(aes(color = sex))\n```\n\n::: {.cell-output-display}\n![&nbsp;](dimension-reduction-1_files/figure-revealjs/blue-jays-pca-plot-1.svg){width=100%}\n:::\n:::\n\n\n\n:::\n\n## Calculate the components and plot\n\n::: {.small-font}\nPlot PC 3 against PC 2\n:::\n\n::: {.tiny-font}\n\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code}\npca_fit |>\n  # add PCs to the original dataset\n  augment(blue_jays) |>\n  ggplot(aes(.fittedPC2, .fittedPC3)) +\n  geom_point(aes(color = sex))\n```\n\n::: {.cell-output-display}\n![&nbsp;](dimension-reduction-1_files/figure-revealjs/blue-jays-pca-plot2-1.svg){width=100%}\n:::\n:::\n\n\n\n:::\n\n## Plot the rotation matrix\n\n::: {.tiny-font}\n\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code}\narrow_style <- arrow(\n  angle = 20, length = grid::unit(8, \"pt\"),\n  ends = \"first\", type = \"closed\"\n)\n\npca_fit |>\n  # extract rotation matrix\n  tidy(matrix = \"rotation\") |>\n  pivot_wider(\n    names_from = \"PC\", values_from = \"value\",\n    names_prefix = \"PC\"\n  ) |>\n  ggplot(aes(PC1, PC2)) +\n  geom_segment(\n    xend = 0, yend = 0,\n    arrow = arrow_style\n  ) +\n  geom_text(aes(label = column), hjust = 1) +\n  coord_fixed(\n    xlim = c(-1.5, 0.5),\n    ylim = c(-1, 1) \n  )\n```\n\n::: {.cell-output-display}\n![&nbsp;](dimension-reduction-1_files/figure-revealjs/blue-jays-pca-rotation-1.svg){width=100%}\n:::\n:::\n\n\n\n:::\n\n## Plot the variance explained\n\n::: {.tiny-font}\n\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code}\npca_fit |>\n  # extract eigenvalues\n  tidy(matrix = \"eigenvalues\") |>\n  ggplot(aes(PC, percent)) + \n  geom_col() + \n  scale_x_continuous(\n    # create one axis tick per PC\n    breaks = 1:6\n  ) +\n  scale_y_continuous(\n    name = \"variance explained\",\n    # format y axis ticks as percent values\n    label = scales::label_percent(accuracy = 1)\n  )\n```\n\n::: {.cell-output-display}\n![&nbsp;](dimension-reduction-1_files/figure-revealjs/blue-jays-pca-eigenvalues-1.svg){width=100%}\n:::\n:::\n\n\n\n:::\n\n## PCA on pottery data\n\n::: {.fragment .tiny-font}\n\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code}\npca_fit <- pottery |> \n  select(where(is.numeric)) |>\n  scale() |>\n  prcomp()\n\npca_fit |>\n  augment(pottery) |>\n  ggplot(aes(.fittedPC1, .fittedPC2)) +\n  geom_point(aes(color = Region)) +\n  theme(legend.position = \"top\")\n```\n\n::: {.cell-output-display}\n![&nbsp;](dimension-reduction-1_files/figure-revealjs/pottery-pca-plot-1.svg){width=100%}\n:::\n:::\n\n\n\n:::\n\n## Plot the rotation matrix\n\n::: {.tiny-font}\n\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code}\narrow_style <- arrow(\n  angle = 20, length = grid::unit(8, \"pt\"),\n  ends = \"first\", type = \"closed\"\n)\n\npca_fit |>\n  tidy(matrix = \"rotation\") |>\n  pivot_wider(\n    names_from = \"PC\", values_from = \"value\",\n    names_prefix = \"PC\"\n  ) |>\n  ggplot(aes(PC1, PC2)) +\n  geom_segment(\n    xend = 0, yend = 0,\n    arrow = arrow_style\n  ) +\n  geom_text(aes(label = column), hjust = 1) +\n  coord_fixed(\n    xlim = c(-.7, 0.7),\n    ylim = c(-.5, .7) \n  )\n```\n\n::: {.cell-output-display}\n![&nbsp;](dimension-reduction-1_files/figure-revealjs/pottery-pca-rotation-1.svg){width=100%}\n:::\n:::\n\n\n\n:::\n\n## Plot the rotation matrix w/ manual label adjustment\n\n::: {.tiny-font}\n\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code}\narrow_style <- arrow(\n  angle = 20, length = grid::unit(8, \"pt\"),\n  ends = \"first\", type = \"closed\"\n)\n\npca_fit |>\n  tidy(matrix = \"rotation\") |>\n  pivot_wider(\n    names_from = \"PC\", values_from = \"value\",\n    names_prefix = \"PC\"\n  )  |>\n  mutate(\n    # order of variables is:\n    # Al2O3, Fe2O3, MgO, CaO, Na2O, K2O, TiO2, MnO, BaO  \n    hjust = c(1.05, -.05, -.05, .5, .5, -.05, 1.05, -.05, 1.05),\n    vjust = c(.5, .5, .5, -.1, -.1, .8, .5, .2, 0)\n  ) |>\n  ggplot(aes(PC1, PC2)) +\n  geom_segment(\n    xend = 0, yend = 0,\n    arrow = arrow_style\n  ) +\n  geom_text(aes(label = column, hjust = hjust, vjust = vjust)) +\n  coord_fixed(\n    xlim = c(-.7, 0.7),\n    ylim = c(-.5, .7) \n  )\n```\n\n::: {.cell-output-display}\n![&nbsp;](dimension-reduction-1_files/figure-revealjs/pottery-pca-rotation2-1.svg){width=100%}\n:::\n:::\n\n\n\n:::\n\n## Plot the variance explained\n\n::: {.tiny-font}\n\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code}\npca_fit |>\n  tidy(matrix = \"eigenvalues\") |>\n  ggplot(aes(PC, percent)) + \n  geom_col() + \n  scale_x_continuous(\n    # create one axis tick per PC\n    breaks = 1:9\n  ) +\n  scale_y_continuous(\n    name = \"variance explained\",\n    # format y axis ticks as percent values\n    label = scales::label_percent(accuracy = 1)\n  )\n```\n\n::: {.cell-output-display}\n![&nbsp;](dimension-reduction-1_files/figure-revealjs/pottery-pca-eigenvalues-1.svg){width=100%}\n:::\n:::\n\n\n\n:::\n\n\n<!-- Segment ends here -->\n\n#\n\n## Further reading\n\n- Fundamentals of Data Visualization: [Chapter 12.3: Dimension reduction](https://clauswilke.com/dataviz/visualizing-associations.html#dimension-reduction)\n- Blogpost on PCA: [Principal Component Analysis\nExplained Visually](https://setosa.io/ev/principal-component-analysis/)\n- PCA tutorial with mathematical background: [A Tutorial on Principal Component Analysis](https://arxiv.org/pdf/1404.1100.pdf)\n",
    "supporting": [
      "dimension-reduction-1_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}