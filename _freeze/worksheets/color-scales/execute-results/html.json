{
  "hash": "bcfcacafe75404e437ad2c3836e7222f",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Color scales\"\nauthor: \"Claus O. Wilke\"\nformat: live-html\nengine: knitr\nwebr:\n  render-df: gt-interactive\n---\n\n::: {.cell}\n\n:::\n\n\n\n\n\n## Introduction\n\nIn this worksheet, we will discuss how to change and customize color scales.\n\nFirst we need to load the required R packages. Please wait a moment until the live R session is fully set up and all packages are loaded.\n\n\n\n\n::: {.cell edit='false'}\n```{webr}\n#| warning: false\n#| edit: false\nlibrary(tidyverse)\nlibrary(colorspace)\n```\n:::\n\n\n\n\nNext we set up the data.\n\n\n\n\n::: {.cell edit='false'}\n```{webr}\n#| edit: false\n#| warning: false\ntemperatures <- read_csv(\"https://wilkelab.org/DSC385/datasets/tempnormals.csv\") |>\n  mutate(\n    location = factor(\n      location, levels = c(\"Death Valley\", \"Houston\", \"San Diego\", \"Chicago\")\n    )\n  ) |>\n  select(location, day_of_year, month, temperature)\n\ntemps_months <- read_csv(\"https://wilkelab.org/DSC385/datasets/tempnormals.csv\") |>\n  group_by(location, month_name) |>\n  summarize(mean = mean(temperature)) |>\n  mutate(\n    month = factor(\n      month_name,\n      levels = c(\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\")\n    ),\n    location = factor(\n      location, levels = c(\"Death Valley\", \"Houston\", \"San Diego\", \"Chicago\")\n    )\n  ) |>\n  select(-month_name)\n```\n:::\n\n\n\n\nWe will be working with the dataset `temperatures` that we have used in previous worksheets. This dataset contains the average temperature for each day of the year for four different locations.\n\n\n\n::: {.cell edit='false'}\n```{webr}\n#| edit: false\ntemperatures\n```\n:::\n\n\n\n\nWe will also be working with an aggregated version of this dataset called `temps_months`, which contains the mean temperature for each month for the same locations.\n\n\n\n::: {.cell edit='false'}\n```{webr}\n#| edit: false\ntemps_months\n```\n:::\n\n\n\n\n## Built in **ggplot2** color scales\n\nWe will start with built-in **ggplot2** color scales, which require no additional packages. The scale functions are always named `scale_color_*()` or `scale_fill_*()`, depending on whether they apply to the `color` or `fill` aesthetic. The `*` indicates some other words specifying the type of the scale, for example `scale_color_brewer()` or `scale_color_distiller()` for discrete or continuous scales from the ColorBrewer project, respectively. You can find all available built-in scales [here.](https://ggplot2.tidyverse.org/reference/index.html#scales) \n\nNow consider the following plot:\n\n\n\n::: {.cell edit='false'}\n```{webr}\n#| label: temps-months-default\n#| edit: false\n#| fig-height: 3\nggplot(temps_months, aes(x = month, y = location, fill = mean)) + \n  geom_tile() + \n  coord_fixed(expand = FALSE)\n```\n:::\n\n\n\n\nIf you wanted to change the color scale to one from the ColorBrewer project, which scale function would you have to add? Think about this and then try it out.\n\n\n\n\n::: {.cell exercise='temps-months-distiller'}\n```{webr}\n#| exercise: temps-months-distiller\n#| fig-height: 3\nggplot(temps_months, aes(x = month, y = location, fill = mean)) + \n  geom_tile() + \n  coord_fixed(expand = FALSE) +\n  ___\n```\n:::\n\n\n\n\n::: { .solution exercise=\"temps-months-distiller\" }\n::: { .callout-tip title=\"Solution\" collapse=\"false\"}\n```r\nggplot(temps_months, aes(x = month, y = location, fill = mean)) + \n  geom_tile() + \n  coord_fixed(expand = FALSE) +\n  scale_fill_distiller()\n```\n:::\n:::\n\nMost color scale functions have additional customizations. How to use them depends on the specific scale function. For the ColorBrewer scales you can set `direction = 1` or `direction = -1` to set the direction of the scale (light to dark or dark to light). You can also set the palette via a numeric argument, e.g. `palette = 1`, `palette = 2`, `palette = 3` etc.\n\nTry this out by setting the direction of the scale from light to dark and using palette #4.\n\n\n\n\n::: {.cell exercise='temps-months-distiller2'}\n```{webr}\n#| exercise: temps-months-distiller2\n#| fig-height: 3\n\n```\n:::\n\n\n\n\n::: { .hint exercise=\"temps-months-distiller2\" }\n::: { .callout-tip title=\"Hint\" collapse=\"false\"}\n```r\nggplot(temps_months, aes(x = month, y = location, fill = mean)) + \n  geom_tile() + \n  coord_fixed(expand = FALSE) +\n  scale_fill_distiller(direction = ___, palette = ___)\n```\n:::\n:::\n\n::: { .solution exercise=\"temps-months-distiller2\" }\n::: { .callout-tip title=\"Solution\" collapse=\"false\"}\n```r\nggplot(temps_months, aes(x = month, y = location, fill = mean)) + \n  geom_tile() + \n  coord_fixed(expand = FALSE) +\n  scale_fill_distiller(direction = 1, palette = 4)\n```\n:::\n:::\n\nA popular set of scales are the viridis scales, which are provided by `scale_*_viridis_c()` for continuous data and `scale_*_viridis_d()` for discrete data. Change the above plot to use a viridis scale.\n\n\n\n\n::: {.cell exercise='temps-months-viridis'}\n```{webr}\n#| exercise: temps-months-viridis\n#| fig-height: 3\n\n```\n:::\n\n\n\n\n::: { .solution exercise=\"temps-months-viridis\" }\n::: { .callout-tip title=\"Solution\" collapse=\"false\"}\n```r\nggplot(temps_months, aes(x = month, y = location, fill = mean)) + \n  geom_tile() + \n  coord_fixed(expand = FALSE) +\n  scale_fill_viridis_c()\n```\n:::\n:::\n\nThe viridis scales can be customized with `direction` (as before), `option` (which can be `\"A\"`, `\"B\"`, `\"C\"`, `\"D\"`, or `\"E\"`), and `begin` and `end` which are numerical values between 0 and 1 indicating where in the color scale the data should begin or end. For example, `begin = 0.2` means that the lowest data value is mapped to the 20th percentile in the scale.\n\nTry different choices for `option`, `begin`, and `end` to see how they change the plot.\n\n\n\n\n::: {.cell exercise='temps-months-viridis2'}\n```{webr}\n#| exercise: temps-months-viridis2\n#| fig-height: 3\n\n```\n:::\n\n\n\n\n::: { .solution exercise=\"temps-months-viridis2\" }\n::: { .callout-tip title=\"Solution\" collapse=\"false\"}\n```r\nggplot(temps_months, aes(x = month, y = location, fill = mean)) + \n  geom_tile() + \n  coord_fixed(expand = FALSE) +\n  scale_fill_viridis_c(option = \"B\", begin = 0.15)\n```\n:::\n:::\n\n## Customizing scale title and labels\n\nIn a previous worksheet, we used arguments such as `name`, `breaks`, `labels`, and `limits` to customize the axis. For color scales, instead of an axis we have a legend, and we can use the same arguments inside the scale function to customize how the legend looks.\n\nTry this out. Set the scale limits from 10 to 110 and set the name of the scale and the breaks as you wish.\n\n\n\n::: {.cell exercise='temps-months-viridis3'}\n```{webr}\n#| exercise: temps-months-viridis3\n#| fig-height: 3\n\n```\n:::\n\n\n\n\n::: { .hint exercise=\"temps-months-viridis3\" }\n::: { .callout-tip title=\"Hint\" collapse=\"false\"}\n```r\nggplot(temps_months, aes(x = month, y = location, fill = mean)) + \n  geom_tile() + \n  coord_fixed(expand = FALSE) +\n  scale_fill_viridis_c(\n    name = ___,\n    breaks = ___,\n    limits = ___\n  )\n```\n:::\n:::\n\n::: { .solution exercise=\"temps-months-viridis3\" }\n::: { .callout-tip title=\"Solution\" collapse=\"false\"}\n```r\nggplot(temps_months, aes(x = month, y = location, fill = mean)) + \n  geom_tile() + \n  coord_fixed(expand = FALSE) +\n  scale_fill_viridis_c(\n    name = \"temperature (F)\",\n    breaks = c(25, 50, 75, 100),\n    limits = c(10, 110)\n  )\n```\n:::\n:::\n\n**Note:** Color scales ignore the `expand` argument, so you cannot use it to expand the scale beyond the data values as you can for position scales.\n\n## Binned scales\n\nResearch into human perception has shown that continuous coloring can be difficult to interpret. Therefore, it is often preferable to use a small number of discrete colors to indicate ranges of data values. You can do this in ggplot with binned scales. For example, `scale_fill_viridis_b()` provides a binned version of the viridis scale. Try this out.\n\n\n\n\n::: {.cell exercise='temps-months-viridis4'}\n```{webr}\n#| exercise: temps-months-viridis4\n#| fig-height: 3\n\n```\n:::\n\n\n\n\n::: { .hint exercise=\"temps-months-viridis4\" }\n::: { .callout-tip title=\"Hint\" collapse=\"false\"}\n```r\nggplot(temps_months, aes(x = month, y = location, fill = mean)) + \n  geom_tile() + \n  coord_fixed(expand = FALSE) +\n  ___\n```\n:::\n:::\n\n::: { .solution exercise=\"temps-months-viridis4\" }\n::: { .callout-tip title=\"Solution\" collapse=\"false\"}\n```r\nggplot(temps_months, aes(x = month, y = location, fill = mean)) + \n  geom_tile() + \n  coord_fixed(expand = FALSE) +\n  scale_fill_viridis_b()\n```\n:::\n:::\n\nYou can provide bin breaks directly with the `breaks` argument. Try this out.\n\n\n\n\n::: {.cell exercise='temps-months-viridis5'}\n```{webr}\n#| exercise: temps-months-viridis5\n#| fig-height: 3\n\n```\n:::\n\n\n\n\n::: { .hint exercise=\"temps-months-viridis5\" }\n::: { .callout-tip title=\"Hint\" collapse=\"false\"}\n```r\nggplot(temps_months, aes(x = month, y = location, fill = mean)) + \n  geom_tile() + \n  coord_fixed(expand = FALSE) +\n  scale_fill_viridis_b(\n    breaks = ___\n  )\n```\n:::\n:::\n\n::: { .solution exercise=\"temps-months-viridis5\" }\n::: { .callout-tip title=\"Solution\" collapse=\"false\"}\n```r\nggplot(temps_months, aes(x = month, y = location, fill = mean)) + \n  geom_tile() + \n  coord_fixed(expand = FALSE) +\n  scale_fill_viridis_b(\n    breaks = c(40, 60, 80, 100)\n  )\n```\n:::\n:::\n\n## Scales from the **colorspace** package\n\nThe color scales provided by the **colorspace** package follow a simple naming scheme of the form `scale_<aesthetic>_<datatype>_<colorscale>()`, where `<aesthetic>` is the name of the aesthetic (`fill`, `color`, `colour`), `<datatype>` indicates the type of variable plotted (`discrete`, `continuous`, `binned`), and `colorscale` stands for the type of the color scale (`qualitative`, `sequential`, `diverging`, `divergingx`).\n\nFor the mean temperature plot we have been using throughout this worksheet, which color scale(s) from the **colorspace** package is/are appropriate? Think about this and then try it out.\n\n\n\n\n::: {.cell exercise='temps-months-colorspace'}\n```{webr}\n#| exercise: temps-months-colorspace\n#| fig-height: 3\nggplot(temps_months, aes(x = month, y = location, fill = mean)) + \n  geom_tile() + \n  coord_fixed(expand = FALSE) +\n  ___\n```\n:::\n\n\n\n\n::: { .hint exercise=\"temps-months-colorspace\" }\n::: { .callout-tip title=\"Hint\" collapse=\"false\"}\nTwo alternative options are appropriate. Can you think of both?\n:::\n:::\n\n::: { .solution exercise=\"temps-months-colorspace\" }\n::: { .callout-tip title=\"Solution\" collapse=\"false\"}\n```r\n# Option 1: Continuous scale\nggplot(temps_months, aes(x = month, y = location, fill = mean)) + \n  geom_tile() + \n  coord_fixed(expand = FALSE) +\n  scale_fill_continuous_sequential()\n\n# Option 2: Binned scale\nggplot(temps_months, aes(x = month, y = location, fill = mean)) + \n  geom_tile() + \n  coord_fixed(expand = FALSE) +\n  scale_fill_binned_sequential()\n```\n:::\n:::\n\nYou can customize the colorspace scales with the `palette` argument, which takes the name of a palette (e.g., `\"Inferno\"`, `\"BluYl\"`, `\"Lajolla\"`). Try this out. Also try reversing the scale direction with `rev = TRUE` or `rev = FALSE`. (The **colorspace** scales use `rev` instead of `direction`.) You can find the names of all supported scales [here](https://colorspace.r-forge.r-project.org/articles/hcl_palettes.html) (consider specifically single-hue and multi-hue sequential palettes).\n\n\n\n\n::: {.cell exercise='temps-months-colorspace2'}\n```{webr}\n#| exercise: temps-months-colorspace2\n#| fig-height: 3\n\n```\n:::\n\n\n\n\n::: { .hint exercise=\"temps-months-colorspace2\" }\n::: { .callout-tip title=\"Hint\" collapse=\"false\"}\n```r\nggplot(temps_months, aes(x = month, y = location, fill = mean)) + \n  geom_tile() + \n  coord_fixed(expand = FALSE) +\n  scale_fill_continuous_sequential(\n    palette = ___\n  )\n```\n:::\n:::\n\n::: { .solution exercise=\"temps-months-colorspace2\" }\n::: { .callout-tip title=\"Solution\" collapse=\"false\"}\n```r\nggplot(temps_months, aes(x = month, y = location, fill = mean)) + \n  geom_tile() + \n  coord_fixed(expand = FALSE) +\n  scale_fill_continuous_sequential(\n    palette = \"Lajolla\"\n  )\n```\n:::\n:::\n\nYou can also use `begin` and `end` just like in the viridis scales.\n\n\n## Manual scales\n\nFor discrete data with a small number of categories, it's usually best to set colors manually. This can be done with the scale functions `scale_*_manual()`. These functions take an argument `values` that specifies the color values to use.\n\nTo see how this works, let's go back to this plot of temperatures over time for four locations:\n\n\n\n\n::: {.cell edit='false'}\n```{webr}\n#| label: temps-locations\n#| edit: false\nggplot(temperatures, aes(day_of_year, temperature, color = location)) +\n  geom_line(linewidth = 1)\n```\n:::\n\n\n\n\nLet's use the following four colors: `\"gold2\"`, `\"firebrick\"`, `\"blue3\"`, `\"springgreen4\"`. We can visualize this palette using the function `swatchplot()` from the **colorspace** package.\n\n\n\n\n::: {.cell edit='false'}\n```{webr}\n#| label: swatchplot\n#| edit: false\n#| fig-height: 3\ncolorspace::swatchplot(c(\"gold2\", \"firebrick\", \"blue3\", \"springgreen4\"))\n```\n:::\n\n\n\n\nNow apply this color palette to the temperatures plot, by using the manual color scale.\n\n\n\n\n::: {.cell exercise='temps-locations-manual'}\n```{webr}\n#| exercise: temps-locations-manual\nggplot(temperatures, aes(day_of_year, temperature, color = location)) +\n  geom_line(linewidth = 1) +\n  ___\n```\n:::\n\n\n\n\n::: { .hint exercise=\"temps-locations-manual\" }\n::: { .callout-tip title=\"Hint\" collapse=\"false\"}\n```r\nggplot(temperatures, aes(day_of_year, temperature, color = location)) +\n  geom_line(linewidth = 1) +\n  scale_color_manual(\n    values = ___\n  )\n```\n:::\n:::\n\n::: { .solution exercise=\"temps-locations-manual\" }\n::: { .callout-tip title=\"Solution\" collapse=\"false\"}\n```r\nggplot(temperatures, aes(day_of_year, temperature, color = location)) +\n  geom_line(linewidth = 1) +\n  scale_color_manual(\n    values = c(\"gold2\", \"firebrick\", \"blue3\", \"springgreen4\")\n  )\n```\n:::\n:::\n\nOne problem with this approach is that we can't easily control which data value gets assigned to which color. What if we wanted San Diego to be shown in green and Chicago in blue? The simplest way to resolve this issue is to use a named vector. A named vector in R is a vector where each value has a name. Named vectors are created by writing `c(name1 = value1, name2 = value2, ...)`. See the following example.\n\n\n\n\n::: {.cell edit='false'}\n```{webr}\n#| edit: false\n# regular vector\nc(\"cat\", \"mouse\", \"house\")\n# named vector\nc(A = \"cat\", B = \"mouse\", C = \"house\")\n```\n:::\n\n\n\n\nThe names in the second example are `A`, `B`, and `C`. Notice that the names are not in quotes. However, if you need a name containing a space (such as `Death Valley`), you need to enclose the name in backticks. Thus, our named vector of colors could be written like so:\n\n\n\n\n::: {.cell edit='false'}\n```{webr}\n#| edit: false\nc(`Death Valley` = \"gold2\", Houston = \"firebrick\", Chicago = \"blue3\", `San Diego` = \"springgreen4\")\n```\n:::\n\n\n\n\nNow try to use this color vector in the figure showing temperatures over time.\n\n\n\n::: {.cell exercise='temps-locations-manual2'}\n```{webr}\n#| exercise: temps-locations-manual2\n\n```\n:::\n\n\n\n\n::: { .hint exercise=\"temps-locations-manual2\" }\n::: { .callout-tip title=\"Hint\" collapse=\"false\"}\n```r\ncolorvector <- c(___)\n\nggplot(temperatures, aes(day_of_year, temperature, color = location)) +\n  geom_line(linewidth = 1) +\n  scale_color_manual(\n    values = ___\n  )\n```\n:::\n:::\n\n::: { .solution exercise=\"temps-locations-manual2\" }\n::: { .callout-tip title=\"Solution\" collapse=\"false\"}\n```r\ncolorvector <- c(\n  `Death Valley` = \"gold2\",\n  Houston = \"firebrick\",\n  Chicago = \"blue3\",\n  `San Diego` = \"springgreen4\"\n)\n\nggplot(temperatures, aes(day_of_year, temperature, color = location)) +\n  geom_line(linewidth = 1) +\n  scale_color_manual(\n    values = colorvector\n  )\n```\n:::\n:::\n\nTry some other colors also. For example, you could use the Okabe-Ito colors:\n\n\n\n::: {.cell edit='false'}\n```{webr}\n#| label: swatchplot2\n#| edit: false\n#| fig-height: 3\n# Okabe-Ito colors\ncolorspace::swatchplot(c(\"#E69F00\", \"#56B4E9\", \"#009E73\", \"#F0E442\", \"#0072B2\", \"#D55E00\", \"#CC79A7\", \"#000000\"))\n```\n:::\n\n\n\n\nAlternatively, you can find a list of all named colors [here.](https://www.datanovia.com/en/blog/awesome-list-of-657-r-color-names/) You can also run the command `colors()` in your R console to get a list of all available color names.\n\n**Hint:** It's a good idea to never use the colors `\"red\"`, `\"green\"`, `\"blue\"`, `\"cyan\"`, `\"magenta\"`, `\"yellow\"`. They are extreme points in the RGB color space and tend to look unnatural and cheap. Try this by making a swatch plot of these colors, and compare for example to the color scale containing the colors `\"firebrick\"`, `\"springgreen4\"`, `\"blue3\"`, `\"turquoise3\"`, `\"darkorchid2\"`, `\"gold2\"`. Do you see the difference?\n\n\n\n\n::: {.cell exercise='swatchplot3'}\n```{webr}\n#| exercise: swatchplot3\n#| fig-height: 3\n\n```\n:::\n\n\n\n\n::: { .solution exercise=\"swatchplot3\" }\n::: { .callout-tip title=\"Solution\" collapse=\"false\"}\n```r\ncolorspace::swatchplot(c(\"red\", \"green\", \"blue\", \"cyan\", \"magenta\", \"yellow\"))\ncolorspace::swatchplot(c(\"firebrick\", \"springgreen4\", \"blue3\", \"turquoise3\", \"darkorchid2\", \"gold2\"))\n```\n:::\n:::\n",
    "supporting": [
      "color-scales_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}